# Copyright (c) 2014,2018 Contributors to the Eclipse Foundation
# 
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
# 
# This program and the accompanying materials are made available under the
# terms of the Eclipse Public License 2.0 which is available at
# http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0
# which is available at https://www.apache.org/licenses/LICENSE-2.0.
#
# SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
#
# Contributors: Gabriele Baldoni, ADLINK Technology Inc. - Initial implementation and API

#!/usr/bin/env python3

import sys
import os
from dstore import WebStore
import tempfile
import signal

s = None


def genlty_close(sig, frame):
    if sig == signal.SIGINT:
        if s is not None:
            s.stop()
        exit(0)


if __name__ == '__main__':
    port = 9669
    auth = 'a1b2c3d4'
    if len(sys.argv) > 1:
        if sys.argv[1] == '--help' or sys.argv[1] == '-h' or sys.argv[1] == 'help':
            print('\nUSAGE:\n\tpython3 fog05ws -p port -a auth\n')
            exit(0)
        else:
            idx = 1
            len = len(sys.argv)
            while idx < len:
                if sys.argv[idx] == '-p':
                    port = sys.argv[idx + 1]
                    idx = idx + 2
                elif sys.argv[idx] == '-a':
                    auth = sys.argv[idx + 1]
                    idx = idx + 2
    s = WebStore(port, auth)
    signal.signal(signal.SIGINT, genlty_close)
    s.start()